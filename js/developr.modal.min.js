(function(b,n,v){function M(){var c=b("#modals");0===c.length&&(c=b('<div id="modals"></div>').appendTo(v.body),b.fn.enableFixedFallback&&c.enableFixedFallback());return c}function N(b){b.preventDefault()}n=b(n);var z=b(v),s=b.template.viewportWidth,t=b.template.viewportHeight;n.on("normalized-resize orientationchange",function(){var c=s,a=t,f,d;s=b.template.viewportWidth;t=b.template.viewportHeight;f=Math.round((s-c)/2);d=Math.round((t-a)/2);b.modal.all.each(function(){var a=b(this),c=a.data("modal"),
e,l;c&&(e=a.outerWidth(),l=a.outerHeight(),c.updateMaxSizes(),c.setPosition(a.parseCSSValue("left")+f+Math.round((e-a.outerWidth())/2),a.parseCSSValue("top")+d+Math.round((l-a.outerHeight())/2)))})});b.modal=function(c){var a=b.extend({},b.modal.defaults,c),f=M(),d,g,k,e,l=!1,p=!1,n=!1,A,B,q,u=!1,j,C=!1,m,D=0,E=0,v=0,O=0,F=0,G=0,w,H,I,J,K;c=a.title?"<h3>"+a.title+"</h3>":"";k=a.titleBar||null===a.titleBar&&0<c.length?'<div class="modal-bar">'+c+"</div>":"";var r=[],P="",x=function(h){a.useIframe||
(j&&(m&&(j.detach().insertAfter(m),m.remove()),C&&j.hide(),m=C=j=!1),e.empty(),"string"!==typeof h&&(j=a.content,h='<span class="modal-dom-wrapper"></span>',j.is(":visible")||(C=!0,j.show()),0<j.parent().length&&(m=b('<span style="display:none"></span>').insertBefore(j),j.detach())),e.append(a.beforeContent+h+a.afterContent),j&&(h=e.find(".modal-dom-wrapper"),j.insertAfter(h),h.remove()))},y=function(h,d){var c;!0===h&&!0===d||(a.useIframe?("number"===typeof h&&(h=Math.min(h,A),e.css("width",h+"px"),
l.prop("width",h)),"number"===typeof d&&(d=Math.min(d,B),e.css("height",d+"px"),l.prop("height",d))):(!0!==h&&(e.css({width:h?h+"px":""}),b.fn.refreshInnerTabs&&e.refreshInnerTabs(),c=e.prop("scrollWidth"),c>h&&e.css({width:c+"px"})),!0!==h&&e.css({height:d?d+"px":""}),c=e.prop("scrollHeight"),c>d&&e.css({height:c+"px"})))},L=function(b,c,e){d[e?"animate":"css"]({left:Math.min(Math.max(a.maxSizeMargin,b),s-d.outerWidth()-a.maxSizeMargin),top:Math.min(Math.max(a.maxSizeMargin,c),t-d.outerHeight()-
a.maxSizeMargin)})};c=function(d,c){if(a.useIframe)l.prop("src",d);else{var e=b.extend({},b.modal.defaults.ajax,c,{success:function(a,b,d){x(a);(e.resize||e.resizeOnLoad)&&y(!0,!1);c.success&&c.success.call(this,a,b,d)}});!e.error&&e.errorMessage&&(e.error=function(){x(e.errorMessage);(e.resize||e.resizeOnMessage)&&y(!0,!1)});e.loadingMessage&&(x(e.loadingMessage),(e.resize||e.resizeOnMessage)&&y(!0,!1));b.ajax(d,e)}};var Q=function(){var b=s-2*a.maxSizeMargin-(d.outerWidth()-e.width()),c=t-2*a.maxSizeMargin-
(d.outerHeight()-e.height());A=a.maxWidth?Math.min(a.maxWidth,b):b;B=a.maxHeight?Math.min(a.maxHeight,c):c;a.useIframe?(b=parseInt(l.prop("width"),10)||a.width,c=parseInt(l.prop("height"),10)||a.height,b=Math.min(Math.max(b,a.width),A),c=Math.min(Math.max(c,a.height),B),e.css({width:b+"px",height:c+"px"}),l.prop("width",b),l.prop("height",c)):(b=a.minWidth?Math.min(a.minWidth,b):b,c=a.minHeight?Math.min(a.minHeight,c):c,e.css({maxWidth:A+"px",maxHeight:B+"px",minWidth:b+"px",minHeight:c+"px"}))};
a.blocker&&(q=f.hasClass("with-blocker"),u=b('<div class="modal-blocker"></div>').appendTo(f.addClass("with-blocker")),!q&&b.fn.detectFixedBounds&&f.detectFixedBounds(),a.blockerVisible&&u.addClass("visible"));a.useIframe?(a.width||(a.width=a.maxWidth||a.minWidth||120),a.height||(a.height=a.maxHeight||a.minHeight||120),q=!0===a.scrolling?"":' scrolling="'+("string"===typeof a.scrolling?a.scrolling:"no")+'"',q='<div style="width:'+a.width+"px; height:"+a.height+'px; -webkit-overflow-scrolling:touch; overflow: auto;"><iframe class="modal-iframe" src="'+
(a.url||"")+'" frameborder="0" width="'+a.width+'" height="'+a.height+'"'+q+"></iframe></div>"):(a.minWidth&&r.push("min-width:"+a.minWidth+"px;"),a.minHeight&&r.push("min-height:"+a.minHeight+"px;"),a.width&&r.push("width:"+a.width+"px;"),a.height&&r.push("height:"+a.height+"px;"),a.maxWidth&&r.push("max-width:"+a.maxWidth+"px;"),a.maxHeight&&r.push("max-height:"+a.maxHeight+"px;"),q='<div class="modal-content'+(a.scrolling?" modal-scroll":"")+("left"!==a.contentAlign?" align-"+a.contentAlign:"")+
'" style="'+r.join(" ")+'"></div>');d=b('<div class="modal'+(a.classes?" "+a.classes:"")+'"></div>').appendTo(f);g=0<k.length?b(k).appendTo(d):!1;k=a.contentBg?b('<div class="modal-bg"></div>').appendTo(d):!1;e=b(q).appendTo(k||d);a.useIframe&&(l=e.children("iframe"));!a.useIframe&&a.content&&x(a.content);!a.useIframe&&b.fn.customScroll&&e.customScroll();a.resizable&&(H=function(b){var d=b.pageX-F;b=b.pageY-G;var c=Math.max(a.minWidth,v+w.width*d),e=Math.max(a.minHeight,O+w.height*b),f=0,g=0;a.maxWidth&&
c>a.maxWidth&&(f=c-a.maxWidth,c=a.maxWidth);a.maxHeight&&e>a.maxHeight&&(g=e-a.maxHeight,e=a.maxHeight);y(c,e);L(D+w.left*(d+f),E+w.top*(b+g))},I=function(){z.off("mousemove",H).off("mouseup",I)},b('<div class="modal-resize-nw"></div>').appendTo(d).data("modal-resize",{top:1,left:1,height:-1,width:-1}).add(b('<div class="modal-resize-n"></div>').appendTo(d).data("modal-resize",{top:1,left:0,height:-1,width:0})).add(b('<div class="modal-resize-ne"></div>').appendTo(d).data("modal-resize",{top:1,left:0,
height:-1,width:1})).add(b('<div class="modal-resize-e"></div>').appendTo(d).data("modal-resize",{top:0,left:0,height:0,width:1})).add(b('<div class="modal-resize-se"></div>').appendTo(d).data("modal-resize",{top:0,left:0,height:1,width:1})).add(b('<div class="modal-resize-s"></div>').appendTo(d).data("modal-resize",{top:0,left:0,height:1,width:0})).add(b('<div class="modal-resize-sw"></div>').appendTo(d).data("modal-resize",{top:0,left:1,height:1,width:-1})).add(b('<div class="modal-resize-w"></div>').appendTo(d).data("modal-resize",
{top:0,left:1,height:0,width:-1})).mousedown(function(a){v=e.width();O=e.height();var c=d.position();D=c.left;E=c.top;F=a.pageX;G=a.pageY;w=b(this).data("modal-resize");a.preventDefault();z.on("mousemove",H).on("mouseup",I)}).on("selectstart",N));a.draggable&&(J=function(a){a="touchmove"===a.type?a.originalEvent.touches[0]:a;L(D+(a.pageX-F),E+(a.pageY-G))},K=function(a){a="touchend"===a.type;z.off(a?"touchmove":"mousemove",J).off(a?"touchend":"mouseup",K)},d.on("touchstart mousedown",".modal-bar",
function(a){if(!(0<b(a.target).closest(".modal-actions").length)){var c=d.position();D=c.left;E=c.top;offsetHolder=(touchEvent="touchstart"===a.type)?a.originalEvent.touches[0]:a;F=offsetHolder.pageX;G=offsetHolder.pageY;a.preventDefault();z.on(touchEvent?"touchmove":"mousemove",J).on(touchEvent?"touchend":"mouseup",K)}}).on("selectstart",".modal-bar",N));d.mousedown(function(){d.putModalOnFront()});b.each(a.actions,function(c,e){"function"===typeof e&&(e={click:e});p||(p=b('<ul class="modal-actions children-tooltip"></ul>').prependTo(g||
d).data("tooltip-options",a.actionsTooltips));b("<li"+(e.color?' class="'+e.color+'-hover"':"")+'><a href="#" title="'+c+'">'+c+"</a></li>").appendTo(p).children("a").click(function(a){a.preventDefault();e.click.call(this,b(this).closest(".modal"),a)})});b.each(a.buttons,function(c,d){"function"===typeof d&&(d={click:d});n?P=" mid-margin-left":n=b('<div class="modal-buttons align-'+a.buttonsAlign+(a.buttonsLowPadding?" low-padding":"")+'"></div>').insertAfter(e);b('<button type="button" class="button'+
(d.classes?" "+d.classes:"")+P+'">'+c+"</button>").appendTo(n).click(function(a){d.click.call(this,b(this).closest(".modal"),a)})});Q();d.data("modal",{contentBlock:e,contentBlockIframe:l,setContent:x,load:c,setContentSize:y,setPosition:L,setTitle:function(c){var e;!1!==a.titleBar&&("string"===typeof c&&0<c.length?g?(e=g.children("h3"),0===e.length&&(e=b("<h3></h3>").appendTo(g)),e.html(c)):(g=b('<div class="modal-bar"><h3>'+c+"</h3></div>").prependTo(d),p&&p.detach().prependTo(g)):g&&(p&&p.detach().prependTo(d),
g.remove(),g=!1))},close:function(){a.onClose&&!1===a.onClose.call(d[0])||(u&&u.removeClass("visible"),d.stop(!0).animate({opacity:0,marginTop:"-30px"},300,function(){j&&(m&&(j.detach().insertAfter(m),m.remove()),C&&j.hide());d.remove();u&&(u.remove(),0===f.children(".modal-blocker").length&&(f.removeClass("with-blocker"),b.fn.detectFixedBounds&&f.detectFixedBounds()))}),b.modal.all=d.siblings(".modal"),b.modal.current=0===b.modal.all.length?!1:b.modal.all.last())},updateMaxSizes:Q});d.centerModal().css({opacity:0,
marginTop:"-30px"}).animate({opacity:1,marginTop:"10px"},200).animate({marginTop:0},100);b.modal.current=d;b.modal.all=f.children(".modal");a.onOpen&&a.onOpen.call(d[0]);!a.useIframe&&a.url&&c(a.url,a.ajax);return d};b.modal.current=!1;b.modal.all=b();b.modal.alert=function(c,a){a=a||{};b.modal(b.extend({},b.modal.defaults.alertOptions,a,{content:c}))};b.modal.prompt=function(c,a,f,d){var g=!1,k;"function"!==typeof f&&(d=f,f=null);d=b.extend({},b.modal.defaults.promptOptions,d||{});f&&(k=d.onClose,
d.onClose=function(a){if(!g&&!1===f.call(this))return!1;k&&k.call(this,a)});d.content='<div class="margin-bottom">'+c+'</div><div class="input full-width"><input type="text" name="prompt-value" id="prompt-value" value="" class="input-unstyled full-width"></div>';d.buttons={};d.buttons[d.textCancel]={classes:"glossy",click:function(a){a.closeModal()}};d.buttons[d.textSubmit]={classes:"blue-gradient glossy",click:function(b){g=!0;!1!==a.call(b[0],b.find("input:first").val())&&b.closeModal()}};b.modal(d)};
b.modal.confirm=function(c,a,f,d){d=b.extend({},b.modal.defaults.confirmOptions,d||{});var g=!1,k=d.onClose;d.onClose=function(a){g||f.call(this);k&&k.call(this,a)};d.content=c;d.buttons={};d.buttons[d.textCancel]={classes:"glossy",click:function(a){a.closeModal()}};d.buttons[d.textConfirm]={classes:"blue-gradient glossy",click:function(b){g=!0;a.call(b[0]);b.closeModal()}};b.modal(d)};b.fn.modal=function(c){var a=b();this.each(function(){var f=b(this);a.add(b.modal(b.extend({},c,f.data("modal-options"),
{content:f})))});return a};b.fn.getModalContentBlock=function(){if(this.hasClass(".modal-content"))return this;var c=this.getModalWindow().data("modal");return c?c.contentBlockIframe||c.contentBlock:b()};b.fn.getModalWindow=function(){return this.closest(".modal")};b.fn.setModalContent=function(c,a){this.each(function(){var f=b(this).getModalWindow();if(f=0<f.length?f.data("modal"):!1)f.setContent(c),a&&f.setContentSize(!0,!1)});return this};b.fn.setModalContentSize=function(c,a){this.each(function(){var f=
b(this).getModalWindow();(f=0<f.length?f.data("modal"):!1)&&f.setContentSize(c,a)});return this};b.fn.loadModalContent=function(c,a){var f=b.extend({},b.modal.defaults.ajax,a);this.each(function(){var a=b(this).getModalWindow();(a=0<a.length?a.data("modal"):!1)&&a.load(c,f)});return this};b.fn.setModalTitle=function(c){this.each(function(){var a=b(this).getModalWindow();(a=0<a.length?a.data("modal"):!1)&&a.setTitle(c)});return this};b.fn.centerModal=function(c){this.each(function(){var a=b(this).getModalWindow(),
f=0<a.length?a.data("modal"):!1;f&&f.setPosition(Math.round((s-a.outerWidth())/2),Math.round((t-a.outerHeight())/2),c)});return this};b.fn.setModalPosition=function(c,a,f){this.each(function(){var d=b(this).getModalWindow();(d=0<d.length?d.data("modal"):!1)&&d.setPosition(c,a,f)});return this};b.fn.putModalOnFront=function(){if(1<b.modal.all.length){var c=M();this.each(function(){var a=b(this).getModalWindow();0<a.next(".modal").length&&a.detach().appendTo(c)})}return this};b.fn.closeModal=function(){return this.each(function(){var c=
b(this).getModalWindow().data("modal");c&&c.close()})};b.modal.defaults={blocker:!0,blockerVisible:!0,classes:"",beforeContent:"",afterContent:"",content:!1,contentBg:!0,contentAlign:"left",useIframe:!1,url:!1,ajax:{loadingMessage:null,errorMessage:"Error while loading content. Please try again.",resize:!1,resizeOnMessage:!1,resizeOnLoad:!1},titleBar:null,title:!1,draggable:!0,resizable:!0,scrolling:!0,actions:{Close:{color:"red",click:function(b){b.closeModal()}}},actionsTooltips:{spacing:5,classes:["black-gradient"],
animateMove:5},buttons:{Close:{classes:"blue-gradient glossy big full-width",click:function(b){b.closeModal()}}},buttonsAlign:"right",buttonsLowPadding:!1,onOpen:!1,onClose:!1,maxSizeMargin:10,minHeight:16,minWidth:200,maxHeight:!1,maxWidth:!1,height:!1,width:!1,alertOptions:{contentBg:!1,contentAlign:"center",minWidth:120,width:!1,maxWidth:260,resizable:!1,actions:{},buttons:{Close:{classes:"blue-gradient glossy big full-width",click:function(b){b.closeModal()}}},buttonsAlign:"center",buttonsLowPadding:!0},
promptOptions:{width:!1,maxWidth:260,resizable:!1,actions:{},textCancel:"Cancel",textSubmit:"Submit"},confirmOptions:{contentAlign:"center",minWidth:120,width:!1,maxWidth:260,buttonsAlign:"center",textCancel:"Cancel",textConfirm:"Confirm"}}})(jQuery,window,document);